{% extends "admin/base.html" %}

{% block title %}KinoPub Parser Admin{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">KinoPub Parser</a></h1>
{% endblock %}

{% block extrastyle %}
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
    /* ==========================================================================
       СТИЛИ ПРИМЕНЯЮТСЯ ТОЛЬКО ДЛЯ ТЕМНОЙ ТЕМЫ (html[data-theme="dark"])
       Светлая тема останется стандартной Django.
       ========================================================================== */

    html[data-theme="dark"] {
        /* Палитра на основе скриншота KinoPub */
        --body-bg: #14181f;         /* Очень темный фон (основной) */
        --primary: #1b1f26;         /* Фон панелей и хедера */
        --secondary: #232830;       /* Второстепенные элементы */
        
        --primary-fg: #e5e7eb;      /* Основной текст (светло-серый) */
        --body-fg: #9ca3af;         /* Второстепенный текст */
        
        --accent: #2ecc71;          /* Акцентный зеленый (как на кнопках) */
        --accent-red: #e74c3c;      /* Акцентный красный */
        
        --link-fg: #60a5fa;         /* Цвет ссылок */
        --link-hover-color: #93c5fd;
        
        --border-color: #2d333b;    /* Цвет границ */
        --hairline-color: #2d333b;
        
        /* Переопределение переменных Django Admin */
        --header-bg: var(--primary);
        --header-color: var(--primary-fg);
        --darkened-bg: #0d1116;
        
        --button-bg: var(--accent);
        --button-hover-bg: #27ae60;
        --default-button-bg: #374151;
        --default-button-hover-bg: #4b5563;
        
        --object-tools-bg: var(--secondary);
        --object-tools-hover-bg: #374151;
    }

    /* Глобальные стили (ТОЛЬКО DARK) */
    html[data-theme="dark"] body {
        background-color: var(--body-bg) !important;
        color: var(--body-fg) !important;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* Хедер */
    html[data-theme="dark"] #header {
        background-color: var(--primary) !important;
        border-bottom: 1px solid var(--border-color);
    }
    html[data-theme="dark"] #branding h1 {
        color: var(--primary-fg) !important;
    }
    
    /* Ссылки */
    html[data-theme="dark"] a:link, 
    html[data-theme="dark"] a:visited {
        color: var(--link-fg);
    }
    html[data-theme="dark"] a:hover {
        color: var(--link-hover-color);
    }

    /* Контейнеры и модули (карточки) */
    html[data-theme="dark"] .dashboard .module, 
    html[data-theme="dark"] #content-main .module, 
    html[data-theme="dark"] .object-tools a, 
    html[data-theme="dark"] .form-row, 
    html[data-theme="dark"] .changelist-form,
    html[data-theme="dark"] #changelist .results,
    html[data-theme="dark"] .login #content-main,
    html[data-theme="dark"] .login #container {
        background-color: var(--primary) !important;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    /* Заголовки модулей */
    html[data-theme="dark"] .module caption, 
    html[data-theme="dark"] .module h2 {
        background-color: var(--secondary) !important;
        color: var(--primary-fg) !important;
    }

    /* Таблицы */
    html[data-theme="dark"] table thead th {
        background-color: var(--secondary) !important;
        color: var(--primary-fg) !important;
        border-bottom: 1px solid var(--border-color) !important;
    }
    html[data-theme="dark"] table tbody tr {
        background-color: var(--primary) !important;
    }
    html[data-theme="dark"] table tbody tr.row1, 
    html[data-theme="dark"] table tbody tr.row2 {
        background-color: var(--primary) !important;
        border-bottom: 1px solid var(--border-color);
    }
    html[data-theme="dark"] table tbody tr:hover {
        background-color: var(--secondary) !important;
    }
    html[data-theme="dark"] table tbody td {
        border-bottom: 1px solid var(--border-color) !important;
        color: var(--body-fg) !important;
    }

    /* Кнопки действий (Save, etc) */
    html[data-theme="dark"] .submit-row input[type=submit],
    html[data-theme="dark"] #content .submit-row a.deletelink {
        background-color: var(--accent) !important;
        color: white !important;
        border: none;
        text-transform: uppercase;
        font-weight: bold;
        padding: 10px 20px !important;
        border-radius: 4px;
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
        vertical-align: middle;
        line-height: normal;
        cursor: pointer;
        min-height: 35px;
        box-sizing: border-box;
    }

    html[data-theme="dark"] .submit-row input[type=submit]:hover {
        background-color: var(--button-hover-bg) !important;
    }

    /* Специфика для кнопки удаления */
    html[data-theme="dark"] #content .submit-row a.deletelink {
        background-color: var(--accent-red) !important;
        gap: 8px;
    }

    /* Принудительно красим иконку в белый */
    html[data-theme="dark"] #content .submit-row a.deletelink::before {
        color: white !important;
    }

    html[data-theme="dark"] #content .submit-row a.deletelink:hover {
        background-color: #c0392b !important;
    }

    /* Хлебные крошки */
    html[data-theme="dark"] div.breadcrumbs {
        background-color: var(--primary) !important;
        color: var(--body-fg);
        border-bottom: 1px solid var(--border-color);
    }
    html[data-theme="dark"] div.breadcrumbs a {
        color: var(--link-fg) !important;
    }

    /* --- ЗАМЕНА ИКОНОК НА MATERIAL ICONS (ТОЛЬКО В DARK MODE) --- */
    /* В светлой теме останутся стандартные SVG иконки Django */

    /* Сброс стандартных иконок Django */
    html[data-theme="dark"] a.addlink, 
    html[data-theme="dark"] a.changelink, 
    html[data-theme="dark"] a.deletelink, 
    html[data-theme="dark"] a.historylink, 
    html[data-theme="dark"] a.viewlink, 
    html[data-theme="dark"] .model-group .addlink, 
    html[data-theme="dark"] .model-group .changelink, 
    html[data-theme="dark"] .model-group .viewlink,
    html[data-theme="dark"] ul.messagelist li {
        background-image: none !important;
        display: inline-flex !important;
        align-items: center;
        gap: 6px;
        text-decoration: none;
        width: fit-content;
        line-height: 1.2;
        border-radius: 3px;
        vertical-align: middle;
    }

    html[data-theme="dark"] #content a.addlink, 
    html[data-theme="dark"] #content a.changelink, 
    html[data-theme="dark"] #content a.deletelink, 
    html[data-theme="dark"] #content a.historylink, 
    html[data-theme="dark"] #content a.viewlink,
    html[data-theme="dark"] ul.messagelist li {
        padding: 4px 8px !important;
    }

    /* Общие стили для псевдо-элементов иконок */
    html[data-theme="dark"] a.addlink::before, 
    html[data-theme="dark"] a.changelink::before, 
    html[data-theme="dark"] a.deletelink::before, 
    html[data-theme="dark"] a.historylink::before, 
    html[data-theme="dark"] a.viewlink::before,
    html[data-theme="dark"] ul.messagelist li::before {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 18px;
        line-height: 1;
        display: inline-block;
        text-transform: none;
        -webkit-font-smoothing: antialiased;
        flex-shrink: 0; /* Запрещаем иконке сжиматься, если места мало */
    }

    /* Mapping (назначение иконок) */

    /* Добавить (+) */
    html[data-theme="dark"] a.addlink::before {
        content: "add_circle";
        color: var(--accent); 
    }

    /* Изменить (карандаш) */
    html[data-theme="dark"] a.changelink::before {
        content: "edit";
        color: #f39c12; 
    }

    /* Просмотр (глаз) */
    html[data-theme="dark"] a.viewlink::before {
        content: "visibility";
        color: var(--link-fg);
    }

    /* Удалить (мусорка) */
    html[data-theme="dark"] a.deletelink::before {
        content: "delete";
        color: var(--accent-red);
    }

    /* История (часы) */
    html[data-theme="dark"] a.historylink::before {
        content: "history";
        color: var(--body-fg);
    }
    
    /* Иконки сообщений */
    html[data-theme="dark"] ul.messagelist li.success::before {
        content: "check_circle";
        color: var(--accent);
        margin-right: 8px;
    }
    html[data-theme="dark"] ul.messagelist li.warning::before {
        content: "warning";
        color: #f39c12;
        margin-right: 8px;
    }
    html[data-theme="dark"] ul.messagelist li.error::before {
        content: "error";
        color: var(--accent-red);
        margin-right: 8px;
    }
    
    /* Сообщения */
    html[data-theme="dark"] ul.messagelist li {
        background-color: var(--primary) !important;
        border: 1px solid var(--border-color);
        color: var(--primary-fg);
        border-radius: 4px;
        padding: 10px 15px;
        margin-bottom: 5px;
    }

    /* Поиск */
    html[data-theme="dark"] #toolbar #searchbar {
        background-color: var(--secondary) !important;
        color: white !important;
        border: 1px solid var(--border-color);
        padding: 5px;
        border-radius: 4px;
    }
    html[data-theme="dark"] #toolbar input[type=submit] {
        background-color: var(--primary) !important;
        border: 1px solid var(--border-color);
        color: var(--primary-fg);
        cursor: pointer;
    }
    /* --- Иконки для RelatedWidgetWrapper ( ForeignKey, ManyToMany, Autocomplete ) --- */
    /* Эти ссылки содержат <img>, который нужно скрыть и заменить на ::before псевдоэлемент */

    /* Скрываем стандартные картинки */
    html[data-theme="dark"] .related-widget-wrapper-link img {
        display: none !important;
    }
    
    /* Настраиваем контейнер ссылки, чтобы иконка была по центру */
    html[data-theme="dark"] .related-widget-wrapper-link {
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
        width: 24px; 
        height: 24px;
        text-decoration: none;
        vertical-align: middle;
    }
    
    /* Общие стили для иконки Material */
    html[data-theme="dark"] .related-widget-wrapper-link::before {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 20px;
        line-height: 1;
        display: inline-block;
        text-transform: none;
        -webkit-font-smoothing: antialiased;
    }

    /* Назначение конкретных иконок */
    html[data-theme="dark"] .related-widget-wrapper-link.add-related::before {
        content: "add_circle";
        color: var(--accent);
    }
    html[data-theme="dark"] .related-widget-wrapper-link.change-related::before {
        content: "edit";
        color: #f39c12;
    }
    html[data-theme="dark"] .related-widget-wrapper-link.view-related::before {
        content: "visibility";
        color: var(--link-fg);
    }
    html[data-theme="dark"] .related-widget-wrapper-link.delete-related::before {
        content: "delete";
        color: var(--accent-red);
    }
    /* Пагинация (исправление цветов) */
    html[data-theme="dark"] .paginator {
        border-top: 1px solid var(--border-color) !important;
        border-bottom: 1px solid var(--border-color) !important;
        background-color: var(--primary) !important;
        color: var(--body-fg) !important;
    }

    html[data-theme="dark"] .paginator a:link, 
    html[data-theme="dark"] .paginator a:visited {
        background-color: var(--secondary);
        color: var(--primary-fg) !important;
        padding: 4px 10px;
        margin: 0 2px;
        border-radius: 4px;
        border: 1px solid var(--border-color);
        text-decoration: none;
        font-weight: normal;
    }

    html[data-theme="dark"] .paginator a:hover {
        background-color: var(--default-button-hover-bg);
        color: white !important;
        border-color: var(--default-button-hover-bg);
    }

    html[data-theme="dark"] .paginator span.this-page {
        background-color: var(--accent);
        color: white !important;
        padding: 4px 10px;
        margin: 0 2px;
        border-radius: 4px;
        border: 1px solid var(--accent);
        font-weight: bold;
    }
    html[data-theme="dark"] .paginator span.this-page {
        background-color: var(--accent);
        color: white !important;
        padding: 4px 10px;
        margin: 0 2px;
        border-radius: 4px;
        border: 1px solid var(--accent);
        font-weight: bold;
    }

    /* --- Иконки выбора даты и времени (Date/Time Shortcuts) --- */
    /* Скрываем стандартную картинку Django и настраиваем контейнер */
    html[data-theme="dark"] .datetimeshortcuts .date-icon,
    html[data-theme="dark"] .datetimeshortcuts .clock-icon {
        background-image: none !important;
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        vertical-align: middle;
        cursor: pointer;
    }

    /* Иконка календаря */
    html[data-theme="dark"] .datetimeshortcuts .date-icon::before {
        font-family: 'Material Icons';
        content: "event";
        font-size: 20px;
        color: var(--link-fg);
    }

    /* Иконка часов */
    html[data-theme="dark"] .datetimeshortcuts .clock-icon::before {
        font-family: 'Material Icons';
        content: "schedule";
        font-size: 20px;
        color: var(--link-fg);
    }
</style>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // 1. При начальной загрузке: если стоит тема 'auto' или не задана, принудительно ставим 'dark'
        if (document.documentElement.dataset.theme === 'auto' || !document.documentElement.dataset.theme) {
            document.documentElement.dataset.theme = 'dark';
            try { localStorage.setItem('theme', 'dark'); } catch(e){}
        }

        // 2. Глобальная замена иконок Boolean (img) на Material Icons (span)
        // Ищет стандартные Django картинки icon-yes.svg и icon-no.svg и заменяет их на текстовые иконки
        document.querySelectorAll('img[src*="icon-yes.svg"], img[src*="icon-no.svg"]').forEach(function(img) {
            const isYes = img.src.includes('icon-yes.svg');
            const span = document.createElement('span');
            
            // Базовые стили для Material Icons (на случай, если класс .material-icons не подключен глобально)
            span.style.fontFamily = 'Material Icons';
            span.style.fontWeight = 'normal';
            span.style.fontStyle = 'normal';
            span.style.fontSize = '20px'; // Размер как у остальных иконок в теме
            span.style.lineHeight = '1';
            span.style.verticalAlign = 'middle';
            span.style.display = 'inline-block';
            span.style.textTransform = 'none';
            span.style.letterSpacing = 'normal';
            span.style.wordWrap = 'normal';
            span.style.whiteSpace = 'nowrap';
            span.style.direction = 'ltr';
            
            // Настройка иконки и цвета (используем CSS-переменные темы с фоллбэком)
            if (isYes) {
                span.textContent = 'check_circle';
                span.style.color = 'var(--accent, #2ecc71)';
            } else {
                span.textContent = 'cancel';
                span.style.color = 'var(--accent-red, #e74c3c)';
            }
            
            // Сохраняем title/alt для всплывающей подсказки
            if (img.alt) span.title = img.alt;

            if (img.parentNode) {
                img.parentNode.replaceChild(span, img);
            }
        });

        // 3. Наблюдаем за изменением темы. Если она станет 'auto', меняем на 'light'.
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === "attributes" && mutation.attributeName === "data-theme") {
                    const currentTheme = document.documentElement.dataset.theme;
                    if (currentTheme === 'auto') {
                        // Если Django переключил на Auto (это происходит при клике на Dark),
                        // мы сразу переключаем на Light.
                        document.documentElement.dataset.theme = 'light';
                        try { localStorage.setItem('theme', 'light'); } catch(e){}
                    }
                }
            });
        });

        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-theme']
        });
    });
</script>
{% endblock %}