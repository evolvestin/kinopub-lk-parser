from django.core.management.base import BaseCommand

from app.models import Country


class Command(BaseCommand):
    help = 'Populates countries with ISO codes and Emoji flags'

    def handle(self, *args, **options):
        # Словарь соответствия: Название -> (ISO код, Эмодзи)
        # Исторические страны помечены кодами SU, YU, CS и флагом 🚩
        countries_data = {
            'Австралия': ('AU', '🇦🇺'),
            'Австрия': ('AT', '🇦🇹'),
            'Албания': ('AL', '🇦🇱'),
            'Алжир': ('DZ', '🇩🇿'),
            'Аргентина': ('AR', '🇦🇷'),
            'Армения': ('AM', '🇦🇲'),
            'Багамы': ('BS', '🇧🇸'),
            'Беларусь': ('BY', '🇧🇾'),
            'Бельгия': ('BE', '🇧🇪'),
            'Болгария': ('BG', '🇧🇬'),
            'Босния-Герцеговина': ('BA', '🇧🇦'),
            'Ботсвана': ('BW', '🇧🇼'),
            'Бразилия': ('BR', '🇧🇷'),
            'Великобритания': ('GB', '🇬🇧'),
            'Венгрия': ('HU', '🇭🇺'),
            'Венесуэла': ('VE', '🇻🇪'),
            'Вьетнам': ('VN', '🇻🇳'),
            'Германия': ('DE', '🇩🇪'),
            'Гонконг': ('HK', '🇭🇰'),
            'Греция': ('GR', '🇬🇷'),
            'Грузия': ('GE', '🇬🇪'),
            'Дания': ('DK', '🇩🇰'),
            'Египет': ('EG', '🇪🇬'),
            'Израиль': ('IL', '🇮🇱'),
            'Индия': ('IN', '🇮🇳'),
            'Индонезия': ('ID', '🇮🇩'),
            'Иран': ('IR', '🇮🇷'),
            'Ирландия': ('IE', '🇮🇪'),
            'Исландия': ('IS', '🇮🇸'),
            'Испания': ('ES', '🇪🇸'),
            'Италия': ('IT', '🇮🇹'),
            'Казахстан': ('KZ', '🇰🇿'),
            'Канада': ('CA', '🇨🇦'),
            'Китай': ('CN', '🇨🇳'),
            'Колумбия': ('CO', '🇨🇴'),
            'Куба': ('CU', '🇨🇺'),
            'Латвия': ('LV', '🇱🇻'),
            'Ливан': ('LB', '🇱🇧'),
            'Литва': ('LT', '🇱🇹'),
            'Люксембург': ('LU', '🇱🇺'),
            'Мавритания': ('MR', '🇲🇷'),
            'Македония': ('MK', '🇲🇰'),
            'Малайзия': ('MY', '🇲🇾'),
            'Мальта': ('MT', '🇲🇹'),
            'Марокко': ('MA', '🇲🇦'),
            'Мексика': ('MX', '🇲🇽'),
            'Нидерланды': ('NL', '🇳🇱'),
            'Новая Зеландия': ('NZ', '🇳🇿'),
            'Норвегия': ('NO', '🇳🇴'),
            'ОАЭ': ('AE', '🇦🇪'),
            'Пакистан': ('PK', '🇵🇰'),
            'Панама': ('PA', '🇵🇦'),
            'Перу': ('PE', '🇵🇪'),
            'Польша': ('PL', '🇵🇱'),
            'Португалия': ('PT', '🇵🇹'),
            'Россия': ('RU', '🇷🇺'),
            'Румыния': ('RO', '🇷🇴'),
            'СССР': ('SU', None),
            'США': ('US', '🇺🇸'),
            'Саудовская Аравия': ('SA', '🇸🇦'),
            'Сербия': ('RS', '🇷🇸'),
            'Сингапур': ('SG', '🇸🇬'),
            'Словакия': ('SK', '🇸🇰'),
            'Словения': ('SI', '🇸🇮'),
            'Тайвань': ('TW', '🇹🇼'),
            'Таиланд': ('TH', '🇹🇭'),
            'Тунис': ('TN', '🇹🇳'),
            'Турция': ('TR', '🇹🇷'),
            'Узбекистан': ('UZ', '🇺🇿'),
            'Украина': ('UA', '🇺🇦'),
            'Уругвай': ('UY', '🇺🇾'),
            'Филиппины': ('PH', '🇵🇭'),
            'Финляндия': ('FI', '🇫🇮'),
            'Франция': ('FR', '🇫🇷'),
            'Хорватия': ('HR', '🇭🇷'),
            'Чехия': ('CZ', '🇨🇿'),
            'Чехословакия': ('CS', None),
            'Чили': ('CL', '🇨🇱'),
            'Швейцария': ('CH', '🇨🇭'),
            'Швеция': ('SE', '🇸🇪'),
            'Шотландия': ('GB', '🏴󠁧󠁢󠁳󠁣󠁴󠁿'),
            'Эстония': ('EE', '🇪🇪'),
            'ЮАР': ('ZA', '🇿🇦'),
            'Югославия': ('YU', None),
            'Южная Корея': ('KR', '🇰🇷'),
            'Япония': ('JP', '🇯🇵'),
        }

        updated_count = 0
        not_found = []

        for name, (iso, flag) in countries_data.items():
            try:
                country = Country.objects.get(name=name)
                country.iso_code = iso.lower() if iso else None
                country.emoji_flag = flag
                country.save()
                updated_count += 1
            except Country.DoesNotExist:
                not_found.append(name)

        self.stdout.write(self.style.SUCCESS(f'Updated {updated_count} countries.'))

        if not_found:
            self.stdout.write(
                self.style.WARNING(f'Countries not found in DB: {", ".join(not_found)}')
            )
